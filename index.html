<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat App</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
        }

        body {
            background: #f5f5f5;
            min-height: 100vh;
        }

        .screen {
            display: none;
            min-height: 100vh;
        }

        .screen.active {
            display: block;
        }

        .auth-screen {
            background: #fff;
            padding: 40px 20px;
        }

        .auth-container {
            max-width: 400px;
            margin: 0 auto;
            padding: 40px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .auth-logo h1 {
            font-size: 32px;
            color: #000;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-group label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .input-group input {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
        }

        .auth-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        .auth-button {
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
        }

        .auth-button.primary {
            background: #000;
            color: white;
        }

        /* Chat Screen Styles */
        .chat-header {
            background: #000;
            color: white;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .chat-user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #333;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 16px;
        }

        .header-actions {
            display: flex;
            gap: 20px;
        }

        .header-button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 20px;
        }

        .messages-container {
            height: calc(100vh - 130px);
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            max-width: 65%;
            padding: 12px 16px;
            border-radius: 12px;
            margin: 5px 0;
        }

        .message.sent {
            background: #000;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .message.received {
            background: white;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .input-area {
            padding: 16px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            gap: 12px;
        }

        .message-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 24px;
            outline: none;
            font-size: 15px;
        }

        .send-button {
            background: #000;
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* Users Screen Styles */
        .users-screen {
            background: #fff;
        }

        .users-header {
            background: #000;
            color: white;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .users-list {
            padding: 16px;
        }

        .user-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }

        .user-item:hover {
            background: #f5f5f5;
        }
    </style>
</head>
<body>
    <!-- Auth Screen -->
    <div id="authScreen" class="screen auth-screen">
        <div class="auth-container">
            <div class="auth-logo">
                <h1>Chat App</h1>
            </div>
            <div class="auth-form">
                <div class="input-group">
                    <label for="emailInput">Email address</label>
                    <input type="email" id="emailInput" placeholder="Enter your email">
                </div>
                <div class="input-group">
                    <label for="passwordInput">Password</label>
                    <input type="password" id="passwordInput" placeholder="Enter your password">
                </div>
                <div class="auth-buttons">
                    <button id="continueButton" class="auth-button primary">Continue to App</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Screen -->
    <div id="chatScreen" class="screen">
        <div class="chat-header">
            <div class="chat-user-info">
                <div class="avatar" id="chatUserAvatar">?</div>
                <span id="chatUserName">You (Myself)</span>
            </div>
            <div class="header-actions">
                <button class="header-button" onclick="showUsers()">
                    <i class="fas fa-users"></i>
                </button>
            </div>
        </div>
        <div class="messages-container" id="messagesContainer"></div>
        <div class="input-area">
            <input type="text" class="message-input" id="messageInput" placeholder="Type a message...">
            <button class="send-button" id="sendButton">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Users Screen -->
    <div id="usersScreen" class="screen users-screen">
        <div class="users-header">
            <h2>All Users</h2>
            <button class="header-button" onclick="showChat()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="users-list" id="usersList"></div>
    </div>

    <script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAMfI4Qj93P2hI-z47ZAJ_0kg98GMwF4vw",
        authDomain: "web-chatter-763.firebaseapp.com",
        projectId: "web-chatter-763",
        storageBucket: "web-chatter-763.firebasestorage.app",
        messagingSenderId: "262486527894",
        appId: "1:262486527894:web:64688ff7e1b6a6eb7357b7"
    };
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();
    
    // DOM Elements
    const screens = {
        auth: document.getElementById('authScreen'),
        chat: document.getElementById('chatScreen'),
        users: document.getElementById('usersScreen')
    };
    
    const elements = {
        emailInput: document.getElementById('emailInput'),
        passwordInput: document.getElementById('passwordInput'),
        continueButton: document.getElementById('continueButton'),
        messageInput: document.getElementById('messageInput'),
        sendButton: document.getElementById('sendButton'),
        messagesContainer: document.getElementById('messagesContainer'),
        usersList: document.getElementById('usersList'),
        chatUserAvatar: document.getElementById('chatUserAvatar'),
        chatUserName: document.getElementById('chatUserName')
    };
    
    // Global State
    let currentUser = null;
    let selectedUser = null;
    
    // Screen Management
    function showScreen(screenId) {
        Object.values(screens).forEach(screen => screen.classList.remove('active'));
        screens[screenId].classList.add('active');
    }
    
    function showChat() { showScreen('chat'); }
    function showUsers() { showScreen('users'); }
    
    // Authentication Handler
    elements.continueButton.addEventListener('click', () => {
        const email = elements.emailInput.value;
        const password = elements.passwordInput.value;
        
        // Try to sign in first
        auth.signInWithEmailAndPassword(email, password)
            .catch(() => {
                // If sign in fails, create a new account
                auth.createUserWithEmailAndPassword(email, password)
                    .then(userCredential => {
                        const user = userCredential.user;
                        const userData = {
                            email: user.email,
                            name: user.email.split('@')[0],
                            uid: user.uid,
                            createdAt: firebase.database.ServerValue.TIMESTAMP
                        };
                        return database.ref('users/' + user.uid).set(userData);
                    })
                    .catch(error => alert(error.message));
            });
    });
    
    // Auth State Observer
    auth.onAuthStateChanged((user) => {
        if (user) {
            currentUser = user;
            loadUserData();
            loadUsers();
            setupMessaging();
            showChat();
        } else {
            currentUser = null;
            showScreen('auth');
        }
    });
    
    // User Data Management
    function loadUserData() {
        database.ref('users/' + currentUser.uid).once('value')
            .then(snapshot => {
                const userData = snapshot.val();
                if (userData) {
                    elements.chatUserName.textContent = `${userData.name} (Myself)`;
                    elements.chatUserAvatar.textContent = getAvatarLetter(userData.email);
                }
            });
    }
    
    // Users Management
    function loadUsers() {
        database.ref('users').on('value', snapshot => {
            elements.usersList.innerHTML = '';
            snapshot.forEach(childSnapshot => {
                const user = childSnapshot.val();
                const userId = childSnapshot.key;
                if (userId !== currentUser.uid) {
                    const userElement = createUserElement(user, userId);
                    elements.usersList.appendChild(userElement);
                }
            });
        });
    }
    
    function createUserElement(user, userId) {
        const div = document.createElement('div');
        div.className = 'user-item';
        div.innerHTML = `
            <div class="avatar">${getAvatarLetter(user.email)}</div>
            <span class="profile-name">${user.name}</span>
        `;
        div.addEventListener('click', () => {
            selectUser(user, userId);
            showChat();
        });
        return div;
    }
    
    // Chat Management
    function selectUser(user, userId) {
        selectedUser = { ...user, uid: userId };
        elements.chatUserName.textContent = user.name;
        elements.chatUserAvatar.textContent = getAvatarLetter(user.email);
        loadMessages(userId);
    }
    
    function setupMessaging() {
        elements.sendButton.addEventListener('click', sendMessage);
        elements.messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    }
    
    function sendMessage() {
        if (!selectedUser || !elements.messageInput.value.trim()) return;
    
        const message = {
            text: elements.messageInput.value.trim(),
            senderId: currentUser.uid,
            timestamp: firebase.database.ServerValue.TIMESTAMP
        };
    
        const chatId = getChatId(currentUser.uid, selectedUser.uid);
        database.ref('chats/' + chatId).push(message);
        elements.messageInput.value = '';
    }
    
    function loadMessages(userId) {
        const chatId = getChatId(currentUser.uid, userId);
        elements.messagesContainer.innerHTML = '';
        
        database.ref('chats/' + chatId).on('child_added', snapshot => {
            const message = snapshot.val();
            const messageElement = createMessageElement(message);
            elements.messagesContainer.appendChild(messageElement);
            elements.messagesContainer.scrollTop = elements.messagesContainer.scrollHeight;
        });
    }
    
    function createMessageElement(message) {
        const div = document.createElement('div');
        div.className = `message ${message.senderId === currentUser.uid ? 'sent' : 'received'}`;
        div.textContent = message.text;
        return div;
    }
    
    // Utility Functions
    function getAvatarLetter(email) {
        return email ? email[0].toUpperCase() : '?';
    }
    
    function getChatId(uid1, uid2) {
        return uid1 < uid2 ? `${uid1}-${uid2}` : `${uid2}-${uid1}`;
    }
    </script>
</body>
</html>